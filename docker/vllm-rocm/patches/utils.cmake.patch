--- a/cmake/utils.cmake
+++ b/cmake/utils.cmake
@@ -310,10 +310,7 @@
     return()
   endif()
 
-  execute_process(COMMAND ${Python_EXECUTABLE} "-c"
-    "import torch.utils.cpp_extension as t; print(t.ROCM_HOME, end=''); print(' '.join(t._get_rocm_arch_flags()), end='')"
-    OUTPUT_VARIABLE TORCH_HIPCC_FLAGS
-    ERROR_QUIET)
+  execute_process(COMMAND ${Python_EXECUTABLE} "${CMAKE_CURRENT_SOURCE_DIR}/cmake/get_hip_flags.py"
+    OUTPUT_VARIABLE TORCH_HIPCC_FLAGS
+    OUTPUT_STRIP_TRAILING_WHITESPACE
+    ERROR_QUIET)
 
   if (NOT TORCH_HIPCC_FLAGS)
     message(WARNING "Failed to determine ROCM_HOME and ROCM_ARCH from torch.")
